---
layout: post
title:  "[2025]Whole Genome Transformer for Gene Interaction Effects in Microbiome Habitat Specificity"
date:   2025-12-16 21:46:03 -0000
categories: study
---

{% highlight ruby %}

한줄 요약: 이 논문에서는 전체 미생물 유전체에서 서열 정보를 활용하여 서식지 특이성을 예측하는 프레임워크를 제안하고, 이를 통해 유전자 상호작용 효과를 분석하는 방법론을 개발하였다.   


BERT와 유사한 인코더 전용 아키텍처를 사용하여 분류 작업을 수행(입력으로는 ESM-2 모델을 통해 생성된 고정 크기의 유전자 임베딩)
ProGenomes v3 데이터베이스에서 900,000개 이상의 고품질 프로카리오타 유전체로 학습    
훈련 후, 검증 세트에서 정확하게 분류된 샘플에 대해 마지막 레이어의 주의 맵을 추출하고, 상위 k개의 주의 점수를 가진 유전자 쌍을 식별, DBSCAN 클러스터링 알고리즘을 사용하여 유전자 쌍을 클러스터링하고, 각 클러스터 내의 유전자에 대해 기능적 및 분류학적 주석을 추출, 유전자 상호작용 네트워크를 구성하여 특정 서식지에 대한 예측력을 높이는 유전자 쌍을 시각화    


짧은 요약(Abstract) :


이 논문에서는 미생물 유전체의 방대한 유전적 다양성을 활용하여 복잡한 표현형을 예측하고 이해하는 데 어려움을 겪고 있는 문제를 다룹니다. 저자들은 전체 미생물 유전체 서열을 기반으로 서식지 특이성을 예측하기 위해 기존의 대형 모델을 활용하는 프레임워크를 제안합니다. 이 모델을 바탕으로 미생물의 다양한 환경에 대한 적응을 이끄는 유전자 상호작용 효과를 설명하기 위한 기법을 개발하였습니다. 저자들은 다양한 서식지에서 수집된 고품질 미생물 유전체의 대규모 데이터셋을 사용하여 모델을 훈련하고 검증하였으며, 예측 성능이 뛰어날 뿐만 아니라 전체 유전체의 서열 정보를 통해 복잡한 표현형의 기초가 되는 유전자 연관성을 식별할 수 있음을 보여주었습니다. 이 연구는 알려진 중요한 상호작용 네트워크를 회복하고 실험적 후속 연구를 위한 새로운 후보를 제안합니다.



This paper addresses the challenge of predicting and understanding complex phenotypes from genomic data, leveraging the vast genetic diversity within microbiomes. The authors propose a framework that utilizes existing large models for gene vectorization to predict habitat specificity from entire microbial genome sequences. Based on this model, they develop attribution techniques to elucidate gene interaction effects that drive microbial adaptation to diverse environments. They train and validate their approach on a large dataset of high-quality microbiome genomes from different habitats, demonstrating not only solid predictive performance but also how sequence-level information from entire genomes allows for the identification of gene associations underlying complex phenotypes. Their work recovers known important interaction networks and proposes new candidates for experimental follow-up.


* Useful sentences :


{% endhighlight %}

<br/>

[Paper link]()
[~~Lecture link~~]()

<br/>

# 단어정리
*


<br/>
# Methodology




이 논문에서는 미생물의 서열 데이터를 기반으로 복잡한 표현형(예: 서식지 특이성)을 예측하기 위한 새로운 프레임워크를 제안합니다. 이 프레임워크는 전체 미생물 유전체 서열을 활용하여 유전자 상호작용 효과를 이해하고 예측하는 데 중점을 두고 있습니다. 다음은 이 연구에서 사용된 주요 방법론과 아키텍처에 대한 설명입니다.

1. **모델 아키텍처**: 
   - 연구진은 BERT와 유사한 인코더 전용 아키텍처를 사용하여 분류 작업을 수행합니다. 이 모델은 15개의 레이어와 640의 숨겨진 차원을 가지며, 단일 주의(attention) 헤드를 사용합니다. 
   - 입력으로는 ESM-2 모델을 통해 생성된 고정 크기의 유전자 임베딩을 사용합니다. ESM-2는 3억 개의 매개변수를 가진 대형 단백질 언어 모델로, 각 아미노산 서열을 2560 차원의 벡터로 변환합니다.

2. **데이터 전처리**:
   - ProGenomes v3 데이터베이스에서 900,000개 이상의 고품질 프로카리오타 유전체를 수집하여 사용합니다. 이 데이터베이스는 40,000종 이상의 미생물 유전체를 포함하고 있으며, 각 유전체는 약 4억 개의 유전자를 포함합니다.
   - 각 유전체에서 유전자를 식별하기 위해 Prodigal을 사용하여 코딩 유전자를 추출하고, 이를 ESM-2를 통해 고정 크기의 임베딩으로 변환합니다. 최종적으로 각 샘플은 (nj×demb) 차원의 텐서로 표현됩니다.

3. **훈련 과정**:
   - 모델은 4개의 NVIDIA A100 GPU를 사용하여 16 에폭 동안 AdamW 옵티마이저와 선형 학습률 감소를 통해 훈련됩니다. 입력 시퀀스의 최대 길이는 4096으로 설정되며, 이보다 긴 샘플은 잘립니다. 
   - 각 에폭에서, 샘플 내의 컨티그 순서를 무작위로 섞어 모델이 모든 가능한 유전자 쌍 간의 의존성을 학습할 수 있도록 합니다.

4. **어트리뷰션 기법**:
   - 훈련 후, 검증 세트에서 정확하게 분류된 샘플에 대해 마지막 레이어의 주의 맵을 추출하고, 상위 k개의 주의 점수를 가진 유전자 쌍을 식별합니다. 
   - DBSCAN 클러스터링 알고리즘을 사용하여 유전자 쌍을 클러스터링하고, 각 클러스터 내의 유전자에 대해 기능적 및 분류학적 주석을 추출합니다. 
   - 최종적으로, 유전자 상호작용 네트워크를 구성하여 특정 서식지에 대한 예측력을 높이는 유전자 쌍을 시각화합니다.

이러한 방법론을 통해 연구진은 미생물의 서식지 특이성을 예측하고, 유전자 간의 상호작용을 이해하는 데 중요한 통찰을 제공할 수 있었습니다.

---


This paper proposes a novel framework for predicting complex phenotypes (e.g., habitat specificity) based on microbial sequence data. The framework focuses on understanding and predicting gene interaction effects using entire microbial genome sequences. Below is a detailed explanation of the key methodologies and architecture used in this study.

1. **Model Architecture**:
   - The authors employ an encoder-only architecture similar to BERT for classification tasks. This model consists of 15 layers and has a hidden dimension of 640, utilizing a single attention head.
   - For input, fixed-size gene embeddings generated by the ESM-2 model are used. ESM-2 is a large protein language model with 300 million parameters, converting each amino acid sequence into a 2560-dimensional vector.

2. **Data Preprocessing**:
   - The study utilizes genomic data from the ProGenomes v3 database, which contains over 900,000 high-quality prokaryotic genomes from more than 40,000 species. Collectively, these genomes encompass approximately 4 billion genes.
   - To identify genes within each genome, Prodigal is used to extract coding genes, which are then transformed into fixed-size embeddings using ESM-2. Ultimately, each sample is represented as a (nj×demb)-dimensional tensor.

3. **Training Process**:
   - The model is trained using 4 NVIDIA A100 GPUs for 16 epochs with the AdamW optimizer and linear learning rate decay. The maximum input sequence length is set to 4096, and samples longer than this are truncated.
   - During each epoch, the order of contigs within a sample is randomly shuffled to allow the model to learn dependencies between all possible gene pairs.

4. **Attribution Techniques**:
   - After training, the last-layer attention maps are extracted for samples in the validation set that were classified correctly. The top k attention scores are used to identify gene pairs.
   - The DBSCAN clustering algorithm is employed to cluster these gene pairs, and functional and taxonomic annotations are extracted for the genes within each cluster.
   - Finally, gene interaction networks are constructed to visualize gene pairs that enhance predictive power for specific habitats.

Through these methodologies, the authors provide significant insights into predicting microbial habitat specificity and understanding gene interactions.


<br/>
# Results



이 연구에서는 ProGenomes v3 데이터셋을 사용하여 미생물의 서식지 특성을 예측하는 모델을 평가했습니다. 모델의 성능은 1,453개의 검증 샘플을 통해 평가되었으며, 전체 정확도는 71%로 나타났습니다. 이 결과는 복잡한 서식지 특성을 예측하는 데 있어 강력한 성능을 보여줍니다. 

모델의 성능은 서식지 유형에 따라 다르게 나타났습니다. 호스트 샘플의 경우, 정확도는 84%로 가장 높았고, 수생 샘플은 66%, 토양 샘플은 63%의 정확도를 기록했습니다. 특히, 호스트 샘플은 잘 분류되었지만, 토양 샘플은 종종 수생 샘플로 잘못 분류되는 경향이 있었습니다. 이는 호스트 미생물이 대개 공생적이거나 기생적이며, 그들의 유전체가 상당히 다르기 때문입니다. 반면, 토양과 수생 미생물은 다양한 환경에서 생존할 수 있는 강한 적응력을 가지고 있어 이들을 구분하는 것이 어려운 것으로 보입니다.

모델의 내부 검증을 위해 '유사 예제(pseudo-examples)'를 생성했습니다. 이는 모델이 예측한 높은 주의 점수를 가진 유전자 쌍으로만 구성된 입력으로, 평균 약 100개의 유전자로 이루어져 있습니다. 이러한 유사 예제는 원래 유전체의 약 3%만을 포함하고 있으며, 유전자 순서 정보는 손실되었습니다. 그럼에도 불구하고, 모델은 58%의 정확도를 기록하여 유전자 쌍이 서식지 예측에 중요한 정보를 포함하고 있음을 보여주었습니다.

마지막으로, 유전자 쌍 클러스터링을 통해 유전자 쌍의 일관성을 평가했습니다. 클러스터 내의 유전자 쌍은 기능적으로 유사한 것으로 나타났으며, 서로 다른 클러스터는 잘 분리되어 있었습니다. 이는 모델이 서식지 예측에 중요한 다양한 유전자 상호작용의 '허브'를 식별했음을 나타냅니다.




In this study, the model was evaluated using the ProGenomes v3 dataset to predict habitat specificity in microorganisms. The model's performance was assessed on 1,453 validation samples, achieving an overall accuracy of 71%. This result demonstrates strong performance in predicting complex habitat traits.

The model's performance varied by habitat type. The accuracy for host samples was the highest at 84%, followed by aquatic samples at 66% and soil samples at 63%. Notably, host samples were classified well, while soil samples were often misclassified as aquatic. This discrepancy can be attributed to the fact that host microbiomes are typically symbiotic or parasitic, leading to significant genomic differences. In contrast, soil and aquatic microorganisms exhibit strong adaptability, making it challenging to distinguish between them.

For internal validation, 'pseudo-examples' were created, consisting solely of gene pairs identified by the model as highly predictive. These pseudo-examples averaged around 100 genes and represented only about 3% of the original genomes, losing the order information of genes. Despite these limitations, the model achieved an accuracy of 58%, indicating that the identified gene pairs contain significant information for habitat prediction.

Finally, gene pair clustering was conducted to assess the consistency of gene pair predictions. Gene pairs within the same cluster were found to be functionally similar, and different clusters were well-separated. This suggests that the model successfully identified 'hubs' of gene interactions that are predictive of habitat specificity.


<br/>
# 예제




이 논문에서는 미생물의 서식지 특성을 예측하기 위해 전체 유전체 데이터를 활용하는 모델을 제안합니다. 이 모델은 미생물 유전체의 유전자 상호작용 효과를 이해하고 예측하는 데 중점을 두고 있습니다. 

#### 트레이닝 데이터와 테스트 데이터

1. **트레이닝 데이터**:
   - 데이터셋: ProGenomes v3에서 수집된 29,089개의 미생물 유전체로 구성됩니다. 이 데이터셋은 3개의 주요 서식지(호스트, 토양, 수생)에 해당하는 미생물 샘플을 포함하고 있습니다.
   - 각 유전체는 평균적으로 약 3,445개의 유전자로 구성된 여러 개의 컨티그(contig)로 이루어져 있습니다.
   - 유전자 임베딩: 각 유전자는 ESM-2 모델을 사용하여 2,560차원의 고정 크기 벡터로 변환됩니다. 이 벡터는 모델의 입력으로 사용됩니다.

2. **테스트 데이터**:
   - 테스트 데이터는 1,453개의 샘플로 구성되어 있으며, 이 샘플들은 모델의 성능을 평가하는 데 사용됩니다.
   - 각 샘플은 유전자 임베딩으로 표현되며, 모델은 이 데이터를 기반으로 서식지를 분류합니다.

#### 구체적인 인풋과 아웃풋

- **인풋**:
  - 각 샘플은 (n_j × d_emb) 차원의 텐서로 표현됩니다. 여기서 n_j는 샘플에 포함된 유전자의 수, d_emb는 유전자 임베딩의 차원(2,560)입니다.
  - 예를 들어, 한 샘플이 4,000개의 유전자를 포함하고 있다면, 인풋은 (4,000 × 2,560) 차원의 텐서가 됩니다.

- **아웃풋**:
  - 모델의 아웃풋은 각 샘플에 대한 서식지 분류 결과입니다. 서식지는 호스트, 토양, 수생의 세 가지 클래스로 나뉘며, 모델은 각 클래스에 대한 확률을 출력합니다.
  - 예를 들어, 모델이 특정 샘플에 대해 "호스트" 클래스에 85%의 확률을 부여한다면, 이는 해당 샘플이 호스트 서식지에서 유래했을 가능성이 높다는 것을 의미합니다.

#### 구체적인 테스크

- **테스크**: 서식지 특성 예측
  - 모델은 주어진 미생물 유전체의 유전자 정보를 바탕으로 해당 미생물이 어떤 서식지에서 발견될 가능성이 높은지를 예측하는 분류 작업을 수행합니다.
  - 이 과정에서 모델은 유전자 간의 상호작용을 고려하여 예측을 수행하며, 이를 통해 미생물의 서식지 적응 메커니즘을 이해하는 데 기여합니다.

---





This paper proposes a model that utilizes whole genome data to predict habitat specificity in microorganisms. The model focuses on understanding and predicting the gene interaction effects within microbial genomes.

#### Training Data and Test Data

1. **Training Data**:
   - Dataset: Composed of 29,089 microbial genomes collected from ProGenomes v3. This dataset includes microbial samples corresponding to three main habitats: host, soil, and aquatic.
   - Each genome consists of multiple contigs, averaging about 3,445 genes.
   - Gene Embeddings: Each gene is transformed into a fixed-size vector of 2,560 dimensions using the ESM-2 model. These vectors serve as inputs to the model.

2. **Test Data**:
   - The test data consists of 1,453 samples used to evaluate the model's performance.
   - Each sample is represented by gene embeddings, and the model classifies the habitat based on this data.

#### Specific Inputs and Outputs

- **Input**:
  - Each sample is represented as a (n_j × d_emb) dimensional tensor, where n_j is the number of genes in the sample, and d_emb is the dimension of the gene embeddings (2,560).
  - For example, if a sample contains 4,000 genes, the input would be a tensor of size (4,000 × 2,560).

- **Output**:
  - The model's output is the classification result for the habitat of each sample. The habitats are divided into three classes: host, soil, and aquatic, and the model outputs probabilities for each class.
  - For instance, if the model assigns an 85% probability to the "host" class for a specific sample, it indicates a high likelihood that the sample originated from a host habitat.

#### Specific Task

- **Task**: Habitat Specificity Prediction
  - The model performs a classification task to predict the likelihood of a given microbial genome being found in a specific habitat based on its gene information.
  - In this process, the model considers gene interactions to make predictions, contributing to the understanding of microbial habitat adaptation mechanisms.

<br/>
# 요약


이 논문에서는 전체 미생물 유전체에서 서열 정보를 활용하여 서식지 특이성을 예측하는 프레임워크를 제안하고, 이를 통해 유전자 상호작용 효과를 분석하는 방법론을 개발하였다. 실험 결과, 제안된 모델은 71%의 정확도로 서식지 분류를 수행하였으며, 유전자 쌍의 상호작용 네트워크를 통해 생물학적으로 중요한 유전자 후보를 제시하였다. 이러한 접근법은 미생물의 복잡한 표현형을 이해하는 데 기여할 수 있는 잠재력을 지닌다.

---

This paper proposes a framework for predicting habitat specificity from entire microbial genomes using sequence-level information and develops methodologies to analyze gene interaction effects. The experimental results show that the proposed model achieves an accuracy of 71% in habitat classification and suggests biologically significant gene candidates through gene pair interaction networks. This approach holds potential for advancing the understanding of complex phenotypes in microbiomes.

<br/>
# 기타




1. **다이어그램 및 피규어**
   - **Figure 1**: 데이터 전처리 파이프라인을 개념적으로 설명합니다. 각 샘플은 샷건 시퀀싱을 통해 재구성된 전체 유전체를 나타내며, 각 컨티그 내의 모든 유전자를 식별하고, ESM-2 모델을 사용하여 해당 단백질 서열을 고정 크기 벡터 공간으로 임베딩합니다. 이 과정은 전체 유전체에서 유전자 간의 상호작용을 이해하는 데 중요한 기초를 제공합니다.
   - **Figure 2**: 훈련 및 기여 분석 파이프라인을 개념적으로 설명합니다. 모델은 각 샘플의 유전자 임베딩을 입력으로 받아 훈련되며, 훈련 후에는 주의 맵을 추출하여 유전자 쌍 간의 상호작용을 분석합니다. 이 과정은 유전자 간의 상호작용을 이해하고 예측하는 데 중요한 역할을 합니다.
   - **Figure 3**: UMAP을 사용하여 유전자 쌍 클러스터를 시각화합니다. 클러스터 내의 유전자 쌍은 기능적으로 유사하며, 서로 다른 클러스터는 잘 분리되어 있습니다. 이는 특정 서식지와 관련된 유전자 상호작용의 허브를 식별하는 데 도움이 됩니다.
   - **Figure 4**: 특정 유전자 상호작용 네트워크의 예를 보여줍니다. 이 네트워크는 Streptococcus agalactiae의 유전자들로 구성되어 있으며, 각 유전자가 다른 유전자와 어떻게 연결되어 있는지를 보여줍니다. 이는 특정 서식지와 관련된 유전자 상호작용을 이해하는 데 중요한 통찰을 제공합니다.

2. **테이블**
   - **Table 1**: 모델의 분류 성능을 보여줍니다. 전체 정확도는 71%로, 서식지(호스트, 토양, 수생) 간의 성능 차이를 나타냅니다. 호스트 샘플은 잘 식별되지만, 토양 샘플은 종종 수생 샘플로 잘못 분류됩니다. 이는 호스트 미생물이 유전체에서 상당한 차이를 보이는 반면, 자유 생활 미생물은 다양한 환경에서 강한 적응력을 보이기 때문입니다.
   - **Internal Validation**: '의사 예제'를 사용하여 모델의 기여 분석의 유효성을 검증합니다. 이 예제는 기여 분석을 통해 식별된 유전자 쌍으로 구성되며, 여전히 58%의 정확도를 달성합니다. 이는 기여 분석에서 식별된 유전자 쌍이 서식지 예측에 중요한 정보를 포함하고 있음을 나타냅니다.

3. **어펜딕스**
   - 어펜딕스에는 추가적인 데이터, 방법론, 실험 결과 등이 포함되어 있으며, 연구의 신뢰성을 높이고, 제안된 방법론의 유용성을 강조합니다.

---




1. **Diagrams and Figures**
   - **Figure 1**: Conceptually illustrates the data preprocessing pipeline. Each sample represents an entire genome reconstructed from shotgun sequencing, identifying all genes within each contig and embedding the corresponding protein sequences into a fixed-size vector space using the ESM-2 model. This process lays the groundwork for understanding gene interactions within entire genomes.
   - **Figure 2**: Conceptually explains the training and attribution analysis pipeline. The model is trained using gene embeddings as input for each sample, and after training, attention maps are extracted to analyze interactions between gene pairs. This process is crucial for understanding and predicting gene interactions.
   - **Figure 3**: Visualizes gene pair clusters using UMAP. Gene pairs within the same cluster are functionally similar, and different clusters are well-separated. This helps identify hubs of gene interactions that are predictive of specific habitats.
   - **Figure 4**: Shows an example of a gene interaction network constructed from the genes of Streptococcus agalactiae. It illustrates how each gene connects with others, providing insights into gene interactions related to specific habitats.

2. **Tables**
   - **Table 1**: Displays the classification performance of the model, achieving an overall accuracy of 71%. It highlights performance differences across habitats (host, soil, aquatic). Host samples are well-identified, while soil samples are often misclassified as aquatic, indicating significant genomic differences between host-associated and free-living microbes.
   - **Internal Validation**: Validates the effectiveness of the attribution technique using 'pseudo-examples' composed of gene pairs identified through attribution. The model still achieves an accuracy of 58%, suggesting that the gene pairs identified contain significant information for habitat prediction.

3. **Appendix**
   - The appendix includes additional data, methodologies, and experimental results, enhancing the credibility of the research and emphasizing the utility of the proposed methodologies.

<br/>
# refer format:



### BibTeX 형식
```bibtex
@article{Li2025,
  author = {Zhufeng Li and Sandeep S Cranganore and Nicholas Youngblut and Niki Kilbertus},
  title = {Whole Genome Transformer for Gene Interaction Effects in Microbiome Habitat Specificity},
  journal = {Proceedings of the Thirty-Ninth AAAI Conference on Artificial Intelligence (AAAI-25)},
  year = {2025},
  institution = {Technical University of Munich, Helmholtz Munich, Munich Center for Machine Learning, Forschungszentrum Jülich, Technical University of Vienna, Max Planck Institute for Biology, Tübingen},
  email = {zhufeng.li@tum.de, niki.kilbertus@tum.de},
  url = {https://github.com/zhufengli/prokaformer},
  note = {Extended version available at: https://arxiv.org/abs/2405.05998}
}
```

### 시카고 스타일 인용
Li, Zhufeng, Sandeep S Cranganore, Nicholas Youngblut, and Niki Kilbertus. 2025. "Whole Genome Transformer for Gene Interaction Effects in Microbiome Habitat Specificity." In *Proceedings of the Thirty-Ninth AAAI Conference on Artificial Intelligence (AAAI-25)*. Technical University of Munich, Helmholtz Munich, Munich Center for Machine Learning, Forschungszentrum Jülich, Technical University of Vienna, Max Planck Institute for Biology, Tübingen. https://github.com/zhufengli/prokaformer. Extended version available at: https://arxiv.org/abs/2405.05998.
